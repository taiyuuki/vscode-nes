import{r as h,t as r}from"./index-C1mDYnUx.js";import{n as a}from"./Mapper-DR43KiVi-C3VBMEhO.js";class n extends a{chrbank=[0,0,0,0];irqctr=0;irqenable=!1;interrupted=!1;irqtoggle=!1;loadROM(){super.loadROM();for(let t=0;t<16;++t)this.prg_map[t]=1024*t&this.prgsize-1;for(let t=1;t<=16;++t)this.prg_map[32-t]=this.prgsize-1024*t;for(let t=0;t<8;++t)this.chr_map[t]=1024*t&this.chrsize-1}cartWrite(t,i){if(t>=34816&&t<=36863)this.chrbank[0]=i,this.setupchr();else if(t>=38912&&t<=40959)this.chrbank[1]=i,this.setupchr();else if(t>=43008&&t<=45055)this.chrbank[2]=i,this.setupchr();else if(t>=47104&&t<=49151)this.chrbank[3]=i,this.setupchr();else if(t>=51200&&t<=53247)this.irqtoggle?(this.irqctr=65280&this.irqctr|255&i,this.irqtoggle=!1):(this.irqctr=255&this.irqctr|i<<8,this.irqtoggle=!0);else if(t>=55296&&t<=57343)this.interrupted&&(--this.cpu.interrupt,this.interrupted=!1),this.irqenable=(i&h.BIT4)!==0,this.irqtoggle=!1;else if(t>=59392&&t<=61439)switch(3&i){case 0:this.setmirroring(r.V_MIRROR);break;case 1:this.setmirroring(r.H_MIRROR);break;case 2:this.setmirroring(r.SS_MIRROR0);break;case 3:this.setmirroring(r.SS_MIRROR1)}else if(t>=63488&&t<=65535)for(let s=0;s<16;++s)this.prg_map[s]=1024*(s+16*i)&this.prgsize-1}cpucycle(t){this.irqenable&&(this.irqctr<=0?(this.irqctr=65535,this.interrupted||(++this.cpu.interrupt,this.interrupted=!0),this.irqenable=!1):this.irqctr-=t)}setupchr(){this.setppubank(2,0,this.chrbank[0]),this.setppubank(2,2,this.chrbank[1]),this.setppubank(2,4,this.chrbank[2]),this.setppubank(2,6,this.chrbank[3])}setppubank(t,i,s){for(let e=0;e<t;++e)this.chr_map[e+i]=1024*(e+2*s)%this.chrsize}}export{n as default};

import o from"./MMC3Mapper-C80ixlo9-C15TrJWb.js";import"./index-C1mDYnUx.js";import"./Mapper-DR43KiVi-C3VBMEhO.js";class l extends o{chrRamControl=128;chrBanksToRam=new Array(8).fill(!1);loadROM(){super.loadROM(),this.haschrram=!0;const r=this.chrsize;if(r===0)this.chrsize=8192,this.chr=new Array(this.chrsize).fill(0);else{const a=r+8192,s=new Array(a).fill(0);for(let h=0;h<r;h++)s[h]=this.chr[h];this.chr=s,this.chrsize=a}this.chrRamControl=192,this.updateChrRamMapping()}ppuWrite(r,a){r<8192&&this.detectChrRamControl(r,a),super.ppuWrite(r,a)}load1kVromBank(r,a){if(this.chrsize===0)return;const s=a>>10;if(this.chrBanksToRam[s]){const h=Math.max(0,this.chrsize-8192),t=1024*r%8192;this.chr_map[s]=h+t}else super.load1kVromBank(r,a)}detectChrRamControl(r,a){if(!(1023&r)){const s=a;128&s&&this.chrRamControl!==s&&(this.chrRamControl=s,this.updateChrRamMapping())}}updateChrRamMapping(){const r=this.chrRamControl;if(64&r)return this.chrBanksToRam.fill(!1),void this.remapChrBanks();const a=!!(32&r),s=a?2:4,h=31&r;switch(this.chrBanksToRam.fill(!1),h){case 0:for(let t=0;t<s;t++)this.chrBanksToRam[t]=!0;break;case 2:for(let t=0;t<s;t++)this.chrBanksToRam[t]=!0;break;case 8:if(a)for(let t=0;t<2;t++)this.chrBanksToRam[t]=!0;else for(let t=4;t<8;t++)this.chrBanksToRam[t]=!0;break;case 10:for(let t=0;t<s;t++)this.chrBanksToRam[t]=!0}this.remapChrBanks()}postLoadState(r){super.postLoadState(r),r.chrRamControl!==void 0&&(this.chrRamControl=r.chrRamControl),r.chrBanksToRam&&(this.chrBanksToRam=[...r.chrBanksToRam]),this.updateChrRamMapping()}}export{l as default};

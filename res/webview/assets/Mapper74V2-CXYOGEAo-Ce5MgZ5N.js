import{t as i}from"./index-C1mDYnUx.js";import h from"./MMC3Mapper-C80ixlo9-C15TrJWb.js";import"./Mapper-DR43KiVi-C3VBMEhO.js";class n extends h{reg=new Uint8Array(8);prg0=0;prg1=1;chr01=0;chr23=2;chr4=4;chr5=5;chr6=6;chr7=7;irqEnable=0;irqCounter=0;irqLatch=0;irqRequest=0;patch=0;loadROM(){super.loadROM(),this.setBankCPU(),this.setBankPPU(),this.crc===934151336&&(this.patch=1)}cartWrite(s,t){switch(57345&s){case 32768:this.reg[0]=t,this.setBankCPU(),this.setBankPPU();break;case 32769:switch(this.reg[1]=t,7&this.reg[0]){case 0:this.chr01=254&t,this.setBankPPU();break;case 1:this.chr23=254&t,this.setBankPPU();break;case 2:this.chr4=t,this.setBankPPU();break;case 3:this.chr5=t,this.setBankPPU();break;case 4:this.chr6=t,this.setBankPPU();break;case 5:this.chr7=t,this.setBankPPU();break;case 6:this.prg0=t,this.setBankCPU();break;case 7:this.prg1=t,this.setBankCPU()}break;case 40960:this.reg[2]=t,this.scrolltype!==i.FOUR_SCREEN_MIRROR&&(1&t?this.setmirroring(i.H_MIRROR):this.setmirroring(i.V_MIRROR));break;case 40961:this.reg[3]=t;break;case 49152:this.reg[4]=t,this.irqCounter=t,this.irqRequest=0;break;case 49153:this.reg[5]=t,this.irqLatch=t,this.irqRequest=0;break;case 57344:this.reg[6]=t,this.irqEnable=0,this.irqRequest=0,this.cpu.interrupt=0;break;case 57345:this.reg[7]=t,this.irqEnable=1,this.irqRequest=0;break;default:super.cartWrite(s,t)}}notifyscanline(s){s>=0&&s<=239&&this.ppu?.renderingOn()&&this.irqEnable&&this.irqRequest===0&&(s===0&&this.irqCounter!==0&&this.irqCounter--,this.irqCounter--===0&&(this.irqRequest=255,this.irqCounter=this.irqLatch,this.cpu.interrupt++))}setBankCPU(){const s=this.getPROM8KSize();64&this.reg[0]?this.setPROM32KBank4(s-2,this.prg1,this.prg0,s-1):this.setPROM32KBank4(this.prg0,this.prg1,s-2,s-1)}setBankPPU(){this.getVROM1KSize()?128&this.reg[0]?(this.setBanPPUSub(4,this.chr01+0),this.setBanPPUSub(5,this.chr01+1),this.setBanPPUSub(6,this.chr23+0),this.setBanPPUSub(7,this.chr23+1),this.setBanPPUSub(0,this.chr4),this.setBanPPUSub(1,this.chr5),this.setBanPPUSub(2,this.chr6),this.setBanPPUSub(3,this.chr7)):(this.setBanPPUSub(0,this.chr01+0),this.setBanPPUSub(1,this.chr01+1),this.setBanPPUSub(2,this.chr23+0),this.setBanPPUSub(3,this.chr23+1),this.setBanPPUSub(4,this.chr4),this.setBanPPUSub(5,this.chr5),this.setBanPPUSub(6,this.chr6),this.setBanPPUSub(7,this.chr7)):128&this.reg[0]?(this.setCRAM1KBank(4,this.chr01+0&7),this.setCRAM1KBank(5,this.chr01+1&7),this.setCRAM1KBank(6,this.chr23+0&7),this.setCRAM1KBank(7,this.chr23+1&7),this.setCRAM1KBank(0,7&this.chr4),this.setCRAM1KBank(1,7&this.chr5),this.setCRAM1KBank(2,7&this.chr6),this.setCRAM1KBank(3,7&this.chr7)):(this.setCRAM1KBank(0,this.chr01+0&7),this.setCRAM1KBank(1,this.chr01+1&7),this.setCRAM1KBank(2,this.chr23+0&7),this.setCRAM1KBank(3,this.chr23+1&7),this.setCRAM1KBank(4,7&this.chr4),this.setCRAM1KBank(5,7&this.chr5),this.setCRAM1KBank(6,7&this.chr6),this.setCRAM1KBank(7,7&this.chr7))}setBanPPUSub(s,t){this.patch!==0||t!==8&&t!==9?this.patch===1&&t>=128?this.setCRAM1KBank(s,7&t):this.setCRAM1KBank(s,t):this.setCRAM1KBank(s,7&t)}}export{n as default};

import{n as h}from"./Mapper-DR43KiVi-C3VBMEhO.js";import{t as e}from"./index-C1mDYnUx.js";class n extends h{whichbank=0;prgconfig=!1;chrconfig=!1;irqctrreload=0;irqctr=0;irqenable=!1;irqreload=!1;bank6=0;chrreg=[0,0,0,0,0,0];interrupted=!1;loadrom(){super.loadROM();for(let r=1;r<=32;++r)this.prg_map[32-r]=this.prgsize-1024*r;for(let r=0;r<8;++r)this.chr_map[r]=0;this.setbank6()}cartWrite(r,s){if(r<32768||r>65535)super.cartWrite(r,s);else if(1&~r)if(r>=40960&&r<=49151)this.whichbank=7&s,this.prgconfig=!!(16&s),this.chrconfig=!!(32&s),this.setupchr(),this.setbank6();else if(r>=49152&&r<=57343)switch(this.whichbank){case 0:this.chrreg[0]=s,this.setupchr();break;case 1:this.chrreg[3]=s,this.setupchr();break;case 2:this.chrreg[1]=s,this.setupchr();break;case 3:this.chrreg[5]=s,this.setupchr();break;case 4:this.bank6=s,this.setbank6();break;case 5:for(let t=0;t<8;++t)this.prg_map[t+8]=1024*(t+8*s)%this.prgsize;break;case 6:this.chrreg[2]=s,this.setupchr();break;case 7:this.chrreg[4]=s,this.setupchr()}else r>=57344&&r<=65535&&(this.interrupted&&this.cpu&&--this.cpu.interrupt,this.interrupted=!1,this.irqenable=!1,this.irqctr=this.irqctrreload);else r>=32768&&r<=40959?this.setmirroring(1&s?e.H_MIRROR:e.V_MIRROR):r>=40960&&r<=49151||(r>=49152&&r<=57343?(this.irqreload=!0,this.irqctrreload=s):r>=57344&&r<=65535&&(this.irqenable=!0))}setupchr(){this.chrconfig?(this.setppubank(1,0,this.chrreg[2]),this.setppubank(1,1,this.chrreg[3]),this.setppubank(1,2,this.chrreg[4]),this.setppubank(1,3,this.chrreg[5]),this.setppubank(2,4,this.chrreg[0]>>1<<1),this.setppubank(2,6,this.chrreg[1]>>1<<1)):(this.setppubank(1,4,this.chrreg[2]),this.setppubank(1,5,this.chrreg[3]),this.setppubank(1,6,this.chrreg[4]),this.setppubank(1,7,this.chrreg[5]),this.setppubank(2,0,this.chrreg[0]>>1<<1),this.setppubank(2,2,this.chrreg[1]>>1<<1))}setbank6(){if(this.prgconfig)for(let r=0;r<8;++r)this.prg_map[r]=this.prgsize-16384+1024*r,this.prg_map[r+16]=1024*(r+8*this.bank6)%this.prgsize;else for(let r=0;r<8;++r)this.prg_map[r]=1024*(r+8*this.bank6)%this.prgsize,this.prg_map[r+16]=this.prgsize-16384+1024*r}notifyscanline(r){if(!(r>239&&r!==261)&&this.ppu?.mmc3CounterClocking()&&(this.irqreload&&(this.irqreload=!1,this.irqctr=this.irqctrreload),this.irqctr--<=0)){if(this.irqctrreload===0)return;this.irqenable&&!this.interrupted&&this.cpu&&(++this.cpu.interrupt,this.interrupted=!0),this.irqctr=this.irqctrreload}}setppubank(r,s,t){for(let i=0;i<r;++i)this.chr_map[i+s]=1024*(t+i)%this.chrsize}}export{n as default};

import{n as e}from"./Mapper-DR43KiVi-C3VBMEhO.js";import"./index-C1mDYnUx.js";class h extends e{reg=new Array(8).fill(0);irqEnable=0;irqCounter=0;irqLatch=0;irqRequest=0;spdata=0;loadROM(){super.loadROM();for(let i=0;i<8;i++)this.reg[i]=0;this.setPROM32KBank4(0,1,this.getPROM8KSize()-2,this.getPROM8KSize()-1),this.setVROM8KBank(0),this.irqEnable=0,this.irqCounter=0,this.irqLatch=0,this.irqRequest=0,this.spdata=0}cartWrite(i,t){if(i===20480)switch(t){case 0:this.spdata=0;break;case 2:this.spdata=1}else i>=24576&&i<32768?this.prgram[8191&i]=t:i>=32768?this.write(i,t):super.cartWrite(i,t)}bitRemap(i){return this.spdata!==1?i:(32&i)>>5<<7|(16&i)>>4<<6|(4&i)>>2<<5|(64&i)>>6<<4|(128&i)>>7<<3|(8&i)>>3<<2|(2&i)>>1<<1|1&i}prgBitRemap(i){return this.spdata!==1?i:i<32?(4&i)>>2<<4|(2&i)>>1<<3|(8&i)>>3<<2|(16&i)>>4<<1|1&i:this.bitRemap(i-32)}write(i,t){switch(65281&i){case 32768:case 34816:this.reg[0]=t;break;case 32769:case 34817:switch(7&this.reg[0]){case 0:t=this.bitRemap(t),this.setVROM1KBank(0,254&t),this.setVROM1KBank(1,1|t);break;case 1:t=this.bitRemap(t),this.setVROM1KBank(2,254&t),this.setVROM1KBank(3,1|t);break;case 2:t=this.bitRemap(t),this.setVROM1KBank(4,t);break;case 3:t=this.bitRemap(t),this.setVROM1KBank(5,t);break;case 4:t=this.bitRemap(t),this.setVROM1KBank(6,t);break;case 5:t=this.bitRemap(t),this.setVROM1KBank(7,t);break;case 6:t=this.prgBitRemap(t),this.setPROM8KBank(4,t);break;case 7:t=this.prgBitRemap(t),this.setPROM8KBank(5,t)}break;case 40960:case 43008:this.reg[2]=t,1&t?this.setVRAMMirror(0):this.setVRAMMirror(1);break;case 40961:case 43009:this.reg[3]=t;break;case 49152:case 51200:this.reg[4]=t,this.irqCounter=t,this.irqRequest=0,this.cpu&&(this.cpu.interrupt&=-5);break;case 49153:case 51201:this.reg[5]=t,this.irqLatch=t,this.irqRequest=0,this.cpu&&(this.cpu.interrupt&=-5);break;case 57344:case 59392:this.reg[6]=t,this.irqEnable=0,this.irqRequest=0,this.cpu&&(this.cpu.interrupt&=-5);break;case 57345:case 59393:this.reg[7]=t,this.irqEnable=1,this.irqRequest=0,this.cpu&&(this.cpu.interrupt&=-5)}}notifyscanline(i){i>=0&&i<=239&&this.ppu?.renderingOn()&&this.irqEnable!==0&&this.irqRequest===0&&(i===0&&this.irqCounter!==0&&this.irqCounter--,this.irqCounter--,this.irqCounter<0&&(this.irqRequest=255,this.irqCounter=this.irqLatch,this.cpu&&(this.cpu.interrupt|=4)))}postLoadState(i){this.irqEnable===0&&this.cpu&&(this.cpu.interrupt&=-5)}}export{h as default};

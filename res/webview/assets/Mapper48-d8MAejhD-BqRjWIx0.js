import{t as i,r as a}from"./index-C1mDYnUx.js";import{n as h}from"./Mapper-DR43KiVi-C3VBMEhO.js";class b extends h{prgbank0=0;prgbank1=0;chrbank=[0,0,0,0,0,0];irqctrreload=0;irqctr=0;irqenable=!1;irqreload=!1;interrupted=!1;loadROM(){super.loadROM();for(let t=0;t<16;++t)this.prg_map[t]=1024*t&this.prgsize-1;for(let t=1;t<=16;++t)this.prg_map[32-t]=this.prgsize-1024*t;for(let t=0;t<8;++t)this.chr_map[t]=1024*t&this.chrsize-1}cartWrite(t,s){if(t<32768||t>65535)super.cartWrite(t,s);else if(t<=40959)switch(3&t){case 0:this.prgbank0=s,this.setbanks();break;case 1:this.prgbank1=s,this.setbanks();break;case 2:this.chrbank[0]=s,this.setbanks();break;case 3:this.chrbank[1]=s,this.setbanks()}else if(t<=49151)switch(3&t){case 0:this.chrbank[2]=s,this.setbanks();break;case 1:this.chrbank[3]=s,this.setbanks();break;case 2:this.chrbank[4]=s,this.setbanks();break;case 3:this.chrbank[5]=s,this.setbanks()}else if(t<=57343)switch(3&t){case 0:this.irqctrreload=255&s,this.irqreload=!0;break;case 1:this.irqctr=s,this.irqreload=!0;break;case 2:this.irqenable=!0;break;case 3:this.interrupted&&--this.cpu.interrupt,this.interrupted=!1,this.irqenable=!1,this.irqctr=this.irqctrreload}else t<=65535&&!(3&t)&&this.setmirroring((s&a.BIT6)===0?i.V_MIRROR:i.H_MIRROR)}setbanks(){for(let t=1;t<=16;++t)this.prg_map[32-t]=this.prgsize-1024*t;for(let t=0;t<8;++t)this.prg_map[t]=1024*(t+8*this.prgbank0)&this.prgsize-1;for(let t=0;t<8;++t)this.prg_map[t+8]=1024*(t+8*this.prgbank1)&this.prgsize-1;this.setppubank(1,4,this.chrbank[2]),this.setppubank(1,5,this.chrbank[3]),this.setppubank(1,6,this.chrbank[4]),this.setppubank(1,7,this.chrbank[5]),this.setppubank(2,0,this.chrbank[0]),this.setppubank(2,2,this.chrbank[1])}setppubank(t,s,e){for(let r=0;r<t;++r)this.chr_map[r+s]=1024*(r+t*e)&this.chrsize-1}notifyscanline(t){if(!(t>239&&t!==261)&&this.ppu?.mmc3CounterClocking()&&(this.irqreload&&(this.irqreload=!1,this.irqctr=this.irqctrreload),this.irqctr--<=0)){if(this.irqctrreload===0)return;this.irqenable&&!this.interrupted&&(++this.cpu.interrupt,this.interrupted=!0),this.irqctr=this.irqctrreload}}}export{b as default};

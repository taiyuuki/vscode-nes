import{t as i}from"./index-C1mDYnUx.js";import{n as s}from"./Mapper-DR43KiVi-C3VBMEhO.js";class a extends s{reg=new Array(8).fill(0);prg0=0;prg1=1;prg0L=0;prg1L=1;chr0=0;chr1=1;chr2=2;chr3=3;chr4=4;chr5=5;chr6=6;chr7=7;irqEnable=0;irqCounter=0;irqLatch=0;exPrgSwitch=0;exChrSwitch=0;constructor(t){super(t)}loadROM(){super.loadROM();for(let t=0;t<8;t++)this.reg[t]=0;this.prg0=this.prg0L=0,this.prg1=this.prg1L=1,this.exPrgSwitch=0,this.exChrSwitch=0,this.setBankCPU(),this.chrsize>0?(this.chr0=0,this.chr1=1,this.chr2=2,this.chr3=3,this.chr4=4,this.chr5=5,this.chr6=6,this.chr7=7,this.setBankPPU()):(this.chr0=this.chr2=this.chr4=this.chr5=this.chr6=this.chr7=0,this.chr1=this.chr3=1),this.irqEnable=0,this.irqCounter=0,this.irqLatch=0}cartWrite(t,h){t>=24576&&t<=24578?this.writeLow(t,h):t>=32768&&t<=65535?this.write(t,h):super.cartWrite(t,h)}cartRead(t){return t===24578?0:super.cartRead(t)}writeLow(t,h){switch(t){case 24576:this.exPrgSwitch=h,this.setBankCPU();break;case 24577:this.exChrSwitch=1&h,this.setBankPPU()}}write(t,h){switch(57345&t){case 32768:this.reg[0]=h,this.setBankCPU(),this.setBankPPU();break;case 32769:switch(this.reg[1]=h,7&this.reg[0]){case 0:this.chr0=254&h,this.chr1=this.chr0+1,this.setBankPPU();break;case 1:this.chr2=254&h,this.chr3=this.chr2+1,this.setBankPPU();break;case 2:this.chr4=h,this.setBankPPU();break;case 3:this.chr5=h,this.setBankPPU();break;case 4:this.chr6=h,this.setBankPPU();break;case 5:this.chr7=h,this.setBankPPU();break;case 6:this.prg0=this.prg0L=h,this.setBankCPU();break;case 7:this.prg1=this.prg1L=h,this.setBankCPU()}break;case 40960:this.reg[2]=h,this.scrolltype!==i.FOUR_SCREEN_MIRROR&&(1&h?this.setmirroring(i.H_MIRROR):this.setmirroring(i.V_MIRROR));break;case 40961:this.reg[3]=h;break;case 49152:this.reg[4]=h,this.irqCounter=h,this.irqEnable=255;break;case 49153:this.reg[5]=h,this.irqLatch=h;break;case 57344:this.reg[6]=h,this.irqEnable=0,this.cpu&&(this.cpu.interrupt=0);break;case 57345:this.reg[7]=h,this.irqEnable=255}}notifyscanline(t){t>=0&&t<=239&&this.ppu.renderingOn()&&this.irqEnable>0&&(this.irqCounter===0?(this.irqCounter=this.irqLatch,this.cpu&&this.cpu.interrupt++):this.irqCounter--)}setBankCPU(){if((128&this.exPrgSwitch)>0)this.prg0=this.exPrgSwitch<<1&30,this.prg1=this.prg0+1,this.setPROM32KBank4(this.prg0,this.prg1,this.prg0+2,this.prg1+2);else{this.prg0=this.prg0L,this.prg1=this.prg1L;const t=this.prgsize>>13;(64&this.reg[0])>0?this.setPROM32KBank4(t-2,this.prg1,this.prg0,t-1):this.setPROM32KBank4(this.prg0,this.prg1,t-2,t-1)}}setBankPPU(){if(this.chrsize>0){const t=this.exChrSwitch<<8;(128&this.reg[0])>0?this.setVROM8KBank8(t+this.chr4,t+this.chr5,t+this.chr6,t+this.chr7,t+this.chr0,t+this.chr1,t+this.chr2,t+this.chr3):this.setVROM8KBank8(t+this.chr0,t+this.chr1,t+this.chr2,t+this.chr3,t+this.chr4,t+this.chr5,t+this.chr6,t+this.chr7)}}postLoadState(t){this.setBankCPU(),this.setBankPPU()}}export{a as default};

import{r as h,t as i}from"./index-C1mDYnUx.js";import{n as r}from"./Mapper-DR43KiVi-C3VBMEhO.js";class a extends r{mmc1shift=0;mmc1latch=0;mmc1ctrl=12;mmc1chr0=0;mmc1chr1=0;mmc1prg=0;soromlatch=!1;cpucycleprev=0;framecountprev=0;loadROM(){super.loadROM();for(let t=0;t<32;t++)this.prg_map[t]=1024*t&this.prgsize-1;for(let t=0;t<8;t++)this.chr_map[t]=1024*t&this.chrsize-1;this.setbanks()}cartWrite(t,m){if(t<32768||t>65535)super.cartWrite(t,m);else{if(this.cpu&&this.cpuram?.apu?.nes?.frameCount!==void 0){if(this.cpu.clocks===this.cpucycleprev&&this.cpuram.apu.nes.frameCount===this.framecountprev)return;this.framecountprev=this.cpuram.apu.nes.frameCount,this.cpucycleprev=this.cpu.clocks}if((m&h.BIT7)!==0)return this.mmc1shift=0,this.mmc1latch=0,this.mmc1ctrl|=12,void this.setbanks();if(this.mmc1shift=(this.mmc1shift>>1)+((1&m)<<4),this.mmc1latch++,!(this.mmc1latch<5)){if(t>=32768&&t<=40959){let s;switch(this.mmc1ctrl=31&this.mmc1shift,3&this.mmc1ctrl){case 0:s=i.SS_MIRROR0;break;case 1:s=i.SS_MIRROR1;break;case 2:s=i.V_MIRROR;break;default:s=i.H_MIRROR}this.setmirroring(s)}else t>=40960&&t<=49151?(this.mmc1chr0=31&this.mmc1shift,this.prgsize>262144&&(this.mmc1chr0&=15,this.soromlatch=(this.mmc1shift&h.BIT4)!==0)):t>=49152&&t<=57343?(this.mmc1chr1=31&this.mmc1shift,this.prgsize>262144&&(this.mmc1chr1&=15)):t>=57344&&t<=65535&&(this.mmc1prg=15&this.mmc1shift);this.setbanks(),this.mmc1latch=0,this.mmc1shift=0}}}setbanks(){if((this.mmc1ctrl&h.BIT4)===0)for(let t=0;t<8;t++)this.chr_map[t]=1024*(t+8*(this.mmc1chr0>>1))%this.chrsize;else{for(let t=0;t<4;t++)this.chr_map[t]=1024*(t+4*this.mmc1chr0)%this.chrsize;for(let t=0;t<4;t++)this.chr_map[t+4]=1024*(t+4*this.mmc1chr1)%this.chrsize}if((this.mmc1ctrl&h.BIT3)===0)for(let t=0;t<32;t++)this.prg_map[t]=(1024*t+32768*(this.mmc1prg>>1))%this.prgsize;else if((this.mmc1ctrl&h.BIT2)===0){for(let t=0;t<16;t++)this.prg_map[t]=1024*t;for(let t=0;t<16;t++)this.prg_map[t+16]=(1024*t+16384*this.mmc1prg)%this.prgsize}else{for(let t=0;t<16;t++)this.prg_map[t]=(1024*t+16384*this.mmc1prg)%this.prgsize;for(let t=1;t<=16;t++)this.prg_map[32-t]=this.prgsize-1024*t,this.prg_map[32-t]>262144&&(this.prg_map[32-t]-=262144)}if(this.soromlatch&&this.prgsize>262144)for(let t=0;t<this.prg_map.length;t++)this.prg_map[t]+=262144}}export{a as default};

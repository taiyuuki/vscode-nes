import{n as c}from"./Mapper-DR43KiVi-C3VBMEhO.js";import{s as a,t as l,i as m,r as h}from"./index-C1mDYnUx.js";import{s as u}from"./Namco163SoundChip-DhH6yyfX-ts8qZpah.js";import{t as p}from"./VRC6SoundChip-DWEdLwU8-BfEksc7g.js";import{f}from"./VRC7SoundChip-DFbeBRFC-Bjfj4A1d.js";import{s as v}from"./Sunsoft5BSoundChip-DT7x-Hu--Dc84w65d.js";import{i as A}from"./MMC5SoundChip-BiH_FNxI-Bo1r5xir.js";class g{regEnable=!0;wavetable=new Array(64).fill(0);waveAddr=0;waveOut=0;waveAccum=0;waveWriteEnable=!1;volEnvDirection=!1;volEnvDisable=!1;modEnvDirection=!1;modEnvDisable=!1;volEnvSpeed=0;modEnvSpeed=0;envClockMultiplier=232;pitch=0;modDisable=!1;modCtr=0;modFreq=0;modAccum=0;modTable=new Array(64).fill(0);modTableAddr=0;masterVol=0;volGain=0;modGain=0;lpaccum=0;modout=0;BothEnvDisable=!1;haltWaveAndReset=!1;modEnvAccum=0;volEnvAccum=0;clock(s){for(let t=0;t<s;++t)this.runUnits()}runUnits(){this.pitch+this.modout>0&&!this.haltWaveAndReset&&(this.waveAccum+=this.pitch+this.modout,(65535&this.waveAccum)!==this.waveAccum&&(this.waveAccum&=65535,this.waveAddr=this.waveAddr+1&63)),this.modFreq>0&&!this.modDisable?(this.modAccum+=this.modFreq,(65535&this.modAccum)!==this.modAccum&&(this.modAccum&=65535,this.calculateModulator())):this.modDisable&&(this.modAccum=0,this.modout=0),this.haltWaveAndReset||this.BothEnvDisable||this.envClockMultiplier===0||this.calculateEnvelopes(),this.waveWriteEnable||(this.waveOut=this.wavetable[this.waveAddr]);const s=this.volGain>32?32:this.volGain;let t=this.waveOut*s;switch(this.masterVol){case 1:t*=5;break;case 2:t*=4;break;case 3:t*=3;break;default:t*=8}t+=this.lpaccum,this.lpaccum-=t>>6}calculateModulator(){switch(this.modTable[this.modTableAddr]){case 1:this.modCtr+=1;break;case 2:this.modCtr+=2;break;case 3:this.modCtr+=4;break;case 4:this.modCtr=0;break;case 5:this.modCtr-=4;break;case 6:this.modCtr-=2;break;case 7:this.modCtr-=1;break;default:this.modCtr+=0}this.modTableAddr=this.modTableAddr+1&63,this.modCtr=this.modCtr<<25>>25;let s=this.modCtr*this.modGain,t=15&s;s>>=4,t>0&&!(128&s)&&(this.modCtr<0?s-=1:s+=2),s>=192?s-=256:s<-64&&(s+=256),s=this.pitch*s,t=63&s,s>>=6,t>=32&&(s+=1),this.modout=s}calculateEnvelopes(){this.modEnvDisable||(++this.modEnvAccum,this.modEnvAccum>8*this.envClockMultiplier*(this.modEnvSpeed+1)&&(this.modEnvAccum=0,this.modEnvDirection?this.modGain<32&&++this.modGain:this.modGain>0&&--this.modGain)),this.volEnvDisable||(++this.volEnvAccum,this.volEnvAccum>8*this.envClockMultiplier*(this.volEnvSpeed+1)&&(this.volEnvAccum=0,this.volEnvDirection?this.volGain<32&&++this.volGain:this.volGain>0&&--this.volGain))}write(s,t){if(s===16419&&(this.regEnable=!!(1&t)),this.regEnable)if(s>=16448&&s<=16511)this.waveWriteEnable&&(this.wavetable[s-16448&63]=63&t);else if(s===16512)this.volEnvDisable=!!(128&t),this.volEnvDirection=!!(64&t),this.volEnvDisable&&(this.volGain=63&t),this.volEnvSpeed=63&t,this.volEnvAccum=0;else if(s===16514)this.pitch&=3840,this.pitch|=255&t;else if(s===16515)this.pitch&=255,this.pitch|=(15&t)<<8,this.haltWaveAndReset=!!(128&t),this.haltWaveAndReset&&(this.waveAccum=0,this.waveAddr=0),this.BothEnvDisable=!!(64&t);else if(s===16516)this.modEnvDisable=!!(128&t),this.modEnvDirection=!!(64&t),this.modEnvDisable&&(this.modGain=63&t),this.modEnvSpeed=63&t,this.modAccum=0,this.modEnvAccum=0;else if(s===16517)this.modCtr=(127&t)<<25>>25;else if(s===16518)this.modFreq&=3840,this.modFreq|=255&t;else if(s===16519)this.modFreq&=255,this.modFreq|=(15&t)<<8,this.modDisable=!!(128&t);else if(s===16520){if(this.modDisable)for(let i=0;i<2;++i)this.modTable[this.modTableAddr]=7&t,this.modTableAddr=this.modTableAddr+1&63;this.modAccum=0}else s===16521?(this.masterVol=3&t,this.waveWriteEnable=!!(128&t)):s===16522&&(this.envClockMultiplier=t)}read(s){return s>=16448&&s<16512?64|this.wavetable[s-16448]:s===16528?this.volGain:s===16530?this.modGain:64}getval(){return this.lpaccum}}class d extends c{loadAddr=0;initAddr=0;playAddr=0;song=0;numSongs=0;nsfBanking=!1;nsfStartBanks=new Array(10).fill(0);nsfBanks=new Array(10).fill(0);sndchip=0;vrc6=!1;vrc7=!1;mmc5=!1;n163=!1;s5b=!1;hasInitSound=!1;fds=!1;n163autoincrement=!1;n163soundAddr=0;mmc5multiplier1=0;mmc5multiplier2=0;vrc7regaddr=0;s5bSoundCommand=0;n163Audio;vrc6Audio;vrc7Audio;s5bAudio;mmc5Audio;fdsAudio;control=0;prevcontrol=0;unfinishedcounter=0;time=4;playFrames=0;loadROM(){this.loader.parseHeader(),this.prgsize=this.loader.prgsize,this.mappertype=this.loader.mappertype,this.prgoff=0;for(let i=112;i<120;++i)this.loader.header[i]!==0&&(this.nsfBanking=!0,this.nsfStartBanks[i-112]=this.loader.header[i]);if(this.loadAddr=this.loader.header[8]+(this.loader.header[9]<<8),this.initAddr=this.loader.header[10]+(this.loader.header[11]<<8),this.playAddr=this.loader.header[12]+(this.loader.header[13]<<8),this.numSongs=this.loader.header[6]-1,this.song=this.loader.header[7]-1,this.loader.header[122]===1?this.region=a.PAL:this.region=a.NTSC,this.chroff=0,this.chrsize=0,this.scrolltype=l.V_MIRROR,this.sndchip=this.loader.header[123],!this.nsfBanking&&this.loadAddr<32768)throw new m("NSF with no banking loading low");const s=this.nsfBanking?4095&this.loadAddr:this.loadAddr-32768;this.prg=new Array(1048576).fill(0);const t=this.loader.load(this.loader.romlen(),0);for(let i=0;i<t.length;i++)this.prg[s+i]=t[i];if(this.crc=d.crc32(this.prg),this.haschrram=!0,this.chrsize=8192,this.prg_map=new Array((this.sndchip&h.BIT2)===0?32:40),!this.nsfBanking)for(let i=0;i<8;++i)this.nsfStartBanks[i]=i;(this.sndchip&h.BIT2)!==0&&(this.nsfStartBanks[8]=this.nsfStartBanks[6],this.nsfStartBanks[9]=this.nsfStartBanks[7]),this.chr_map=new Array(8);for(let i=0;i<8;++i)this.chr_map[i]=1024*i&this.chrsize-1;this.pput0.fill(0),this.setmirroring(this.scrolltype),this.chr=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,60,60,60,24,24,0,24,0,0,0,0,0,0,0,0,108,108,108,0,0,0,0,0,0,0,0,0,0,0,0,0,108,108,254,108,254,108,108,0,0,0,0,0,0,0,0,0,48,124,192,120,12,248,48,0,0,0,0,0,0,0,0,0,0,198,204,24,48,102,198,0,0,0,0,0,0,0,0,0,56,108,56,118,220,204,118,0,0,0,0,0,0,0,0,0,96,96,192,0,0,0,0,0,0,0,0,0,0,0,0,0,24,48,96,96,96,48,24,0,0,0,0,0,0,0,0,0,96,48,24,24,24,48,96,0,0,0,0,0,0,0,0,0,0,102,60,255,60,102,0,0,0,0,0,0,0,0,0,0,0,48,48,252,48,48,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,96,0,0,0,0,0,0,0,0,0,0,0,252,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,6,12,24,48,96,192,128,0,0,0,0,0,0,0,0,0,56,76,198,198,198,100,56,0,0,0,0,0,0,0,0,0,24,56,24,24,24,24,126,0,0,0,0,0,0,0,0,0,124,198,14,60,120,224,254,0,0,0,0,0,0,0,0,0,126,12,24,60,6,198,124,0,0,0,0,0,0,0,0,0,28,60,108,204,254,12,12,0,0,0,0,0,0,0,0,0,252,192,252,6,6,198,124,0,0,0,0,0,0,0,0,0,60,96,192,252,198,198,124,0,0,0,0,0,0,0,0,0,254,198,12,24,48,48,48,0,0,0,0,0,0,0,0,0,124,198,198,124,198,198,124,0,0,0,0,0,0,0,0,0,124,198,198,126,6,12,120,0,0,0,0,0,0,0,0,0,0,48,48,0,0,48,48,0,0,0,0,0,0,0,0,0,0,48,48,0,0,48,48,96,0,0,0,0,0,0,0,0,24,48,96,192,96,48,24,0,0,0,0,0,0,0,0,0,0,0,252,0,0,252,0,0,0,0,0,0,0,0,0,0,96,48,24,12,24,48,96,0,0,0,0,0,0,0,0,0,120,204,12,24,48,0,48,0,0,0,0,0,0,0,0,0,124,198,222,222,222,192,120,0,0,0,0,0,0,0,0,0,56,108,198,198,254,198,198,0,0,0,0,0,0,0,0,0,252,198,198,252,198,198,252,0,0,0,0,0,0,0,0,0,60,102,192,192,192,102,60,0,0,0,0,0,0,0,0,0,248,204,198,198,198,204,248,0,0,0,0,0,0,0,0,0,254,192,192,252,192,192,254,0,0,0,0,0,0,0,0,0,254,192,192,252,192,192,192,0,0,0,0,0,0,0,0,0,62,96,192,206,198,102,62,0,0,0,0,0,0,0,0,0,198,198,198,254,198,198,198,0,0,0,0,0,0,0,0,0,126,24,24,24,24,24,126,0,0,0,0,0,0,0,0,0,30,6,6,6,198,198,124,0,0,0,0,0,0,0,0,0,198,204,216,240,248,220,206,0,0,0,0,0,0,0,0,0,96,96,96,96,96,96,126,0,0,0,0,0,0,0,0,0,198,238,254,254,214,198,198,0,0,0,0,0,0,0,0,0,198,230,246,254,222,206,198,0,0,0,0,0,0,0,0,0,124,198,198,198,198,198,124,0,0,0,0,0,0,0,0,0,252,198,198,198,252,192,192,0,0,0,0,0,0,0,0,0,124,198,198,198,222,204,122,0,0,0,0,0,0,0,0,0,252,198,198,206,248,220,206,0,0,0,0,0,0,0,0,0,120,204,192,124,6,198,124,0,0,0,0,0,0,0,0,0,126,24,24,24,24,24,24,0,0,0,0,0,0,0,0,0,198,198,198,198,198,198,124,0,0,0,0,0,0,0,0,0,198,198,198,238,124,56,16,0,0,0,0,0,0,0,0,0,198,198,214,254,254,238,198,0,0,0,0,0,0,0,0,0,198,238,124,56,124,238,198,0,0,0,0,0,0,0,0,0,102,102,102,60,24,24,24,0,0,0,0,0,0,0,0,0,254,14,28,56,112,224,254,0,0,0,0,0,0,0,0,0,120,96,96,96,96,96,120,0,0,0,0,0,0,0,0,0,192,96,48,24,12,6,2,0,0,0,0,0,0,0,0,0,120,24,24,24,24,24,120,0,0,0,0,0,0,0,0,0,16,56,108,198,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,0,0,0,0,0,0,0,0,48,48,24,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,60,102,102,102,59,0,0,0,0,0,0,0,0,0,96,96,124,102,102,102,124,0,0,0,0,0,0,0,0,0,0,0,62,96,96,96,62,0,0,0,0,0,0,0,0,0,6,6,62,102,102,102,62,0,0,0,0,0,0,0,0,0,0,0,60,102,126,96,62,0,0,0,0,0,0,0,0,0,14,24,24,126,24,24,24,0,0,0,0,0,0,0,0,0,0,0,62,102,102,62,6,60,0,0,0,0,0,0,0,0,96,96,96,124,102,102,102,0,0,0,0,0,0,0,0,0,0,24,0,24,24,24,24,0,0,0,0,0,0,0,0,0,0,6,0,6,6,6,102,60,0,0,0,0,0,0,0,0,96,96,98,100,104,124,102,0,0,0,0,0,0,0,0,0,24,24,24,24,24,24,24,0,0,0,0,0,0,0,0,0,0,0,118,107,107,107,107,0,0,0,0,0,0,0,0,0,0,0,124,102,102,102,102,0,0,0,0,0,0,0,0,0,0,0,60,102,102,102,60,0,0,0,0,0,0,0,0,0,0,0,124,102,102,124,96,96,0,0,0,0,0,0,0,0,0,0,62,102,102,62,6,6,0,0,0,0,0,0,0,0,0,0,110,112,96,96,96,0,0,0,0,0,0,0,0,0,0,0,60,64,60,6,124,0,0,0,0,0,0,0,0,0,48,48,252,48,48,48,28,0,0,0,0,0,0,0,0,0,0,0,102,102,102,102,60,0,0,0,0,0,0,0,0,0,0,0,102,102,102,36,24,0,0,0,0,0,0,0,0,0,0,0,99,107,107,107,54,0,0,0,0,0,0,0,0,0,0,0,99,54,28,54,99,0,0,0,0,0,0,0,0,0,0,0,102,102,44,24,48,96,0,0,0,0,0,0,0,0,0,0,126,12,24,48,126,0,0,0,0,0,0,0,0,0,28,48,48,224,48,48,28,0,0,0,0,0,0,0,0,0,24,24,24,0,24,24,24,0,0,0,0,0,0,0,0,0,224,48,48,28,48,48,224,0,0,0,0,0,0,0,0,0,118,220,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,56,108,198,198,254,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}init(){if(this.nsfBanks=this.nsfStartBanks.slice(),this.setBanks(),this.ppu){this.ppu.pal[0]=63;const e=32+this.crc%12;this.ppu.pal[1]=e,this.ppu.pal[2]=e,this.ppu.pal[3]=e}if(this.cpuram){for(let e=0;e<=2047;++e)this.cpuram.write(e,0);for(let e=16384;e<=16403;++e)this.cpuram.write(e,0);this.cpuram.write(16405,15),this.cpuram.write(16407,64)}this.cpu&&(this.cpu.idle=!1,this.cpu.push(255),this.cpu.push(250),this.cpu.setPC(this.initAddr),this.cpu.interrupt=-99999,this.cpu.setA(this.song),this.cpu.setX(this.region===a.PAL?1:0)),this.hasInitSound||(this.setSoundChip(),this.cpuram?.apu&&(this.hasInitSound=!0)),this.clearScreen();const s=this.getHeaderString(14,32)||"Untitled",t=this.getHeaderString(46,32)||"Unknown Artist",i=this.getHeaderString(78,32)||"Unknown Copyright";if(this.centerText(4,"NES Music (NSF)"),this.drawSeparator(5),this.centerText(7,`${s}`),this.centerText(9,`${t}`),this.centerText(11,`${i}`),this.drawSeparator(13),this.centerText(26," B: Previous        A: Next "),this.writeTracks(),this.playFrames=0,this.updateTimeDisplay(),this.unfinishedcounter=0,!this.fds&&this.cpuram)for(let e=24576;e<=32767;++e)this.cpuram.write(e,0)}reset(){this.song=this.loader.header[7]-1,this.init(),this.cpu&&this.cpu.setPC(this.initAddr)}cartWrite(s,t){if(this.n163&&s===63488)this.n163autoincrement=(t&h.BIT7)!==0,this.n163soundAddr=127&t;else if(this.n163&&s===18432)this.n163Audio?.write(this.n163soundAddr,t),this.n163autoincrement&&(this.n163soundAddr=this.n163soundAddr+1&127);else if(this.s5b&&s===57344)this.s5bAudio?.write(this.s5bSoundCommand,t);else if(this.s5b&&s===49152)this.s5bSoundCommand=15&t;else if(this.vrc6&&s>=45056&&s<=45058)this.vrc6Audio?.write((61440&s)+(3&s),t);else if(this.vrc6&&s>=40960&&s<=40962)this.vrc6Audio?.write((61440&s)+(3&s),t);else if(this.vrc7&&s===36912)this.vrc7Audio&&this.vrc7Audio.write(this.vrc7regaddr,t);else if(this.vrc7&&s===36880)this.vrc7regaddr=t;else if(this.vrc6&&s>=36864&&s<=36866)this.vrc6Audio?.write((61440&s)+(3&s),t);else if(this.fds&&this.nsfBanking&&s>=24576)if(s<32768){const i=this.prg_map[32+(s-24576>>10)]+(1023&s);this.prg[i]=t}else{const i=this.prg_map[(32767&s)>>10]+(1023&s);this.prg[i]=t}else if(this.fds&&!this.nsfBanking&&s>=24576)if(s<32768)this.prgram[s-24576]=t;else{const i=this.prg_map[(32767&s)>>10]+(1023&s);this.prg[i]=t}else s>=24576&&s<32768?this.prgram[8191&s]=t:s>=24568&&s<24576?(this.nsfBanks[s-24568]=t,this.setBanks()):this.fds&&this.nsfBanking&&s===24566?(this.nsfBanks[8]=t,this.setBanks()):this.fds&&this.nsfBanking&&s>=24567?(this.nsfBanks[9]=t,this.setBanks()):this.mmc5&&s>=23552&&s<=24565?this.prgram[s-23552]=t:this.mmc5&&s===20998?this.mmc5multiplier2=t:this.mmc5&&s===20997?this.mmc5multiplier1=t:this.mmc5&&s>=20480&&s<=20501?this.mmc5Audio?.write(s-20480,t):this.fds&&s>=16448&&s<=16530&&this.fdsAudio?.write(s,t)}cartRead(s){if(s>=32768){if(s>65530)switch(s){case 65531:return 76;case 65532:return 251;case 65533:return 255;default:return 0}const t=this.prg_map[(32767&s)>>10]+(1023&s);return this.prg[t]}if(s>=24576&&this.hasprgram){if(this.fds&&this.nsfBanking){const t=this.prg_map[32+(s-24576>>10)]+(1023&s);return this.prg[t]}return this.prgram[8191&s]}if(s>=24568)return this.nsfBanks[s-24568];if(this.fds&&this.nsfBanking&&s===24566)return this.nsfBanks[8];if(this.fds&&this.nsfBanking&&s===24567)return this.nsfBanks[9];if(this.mmc5&&s>=23552)return this.prgram[s-23552];if(this.mmc5&&s===20998)return this.mmc5multiplier1*this.mmc5multiplier2>>8&255;if(this.mmc5&&s===20997)return this.mmc5multiplier1*this.mmc5multiplier2&255;if(this.mmc5&&s===20501)return this.mmc5Audio?.status()??0;if(this.n163&&s===18432){const t=this.n163Audio?this.n163Audio.read(this.n163soundAddr):0;return this.n163autoincrement&&(this.n163soundAddr=this.n163soundAddr+1&127),t}return this.fds&&s>=16448&&s<16531?this.fdsAudio?this.fdsAudio.read(s):64:s>>8}notifyscanline(s){if(s===240){if(this.cpu){if(this.cpu.getPC()===65531)this.unfinishedcounter=this.time;else if(this.unfinishedcounter<this.time)return void++this.unfinishedcounter}if(this.ppu&&(this.ppu.write(6,0),this.ppu.write(6,0),this.ppu.write(5,0),this.ppu.write(0,0),this.ppu.write(1,h.BIT1|h.BIT3|h.BIT4)),this.writeTracks(),this.playFrames++,this.updateTimeDisplay(),this.prevcontrol=this.control,this.control=0,this.cpuram){this.cpuram.write(16406,1),this.cpuram.write(16406,0);for(let e=0;e<8;++e){const r=this.cpuram.read(16406);this.control=(this.control<<1)+(3&r?1:0)}}const t=!(!(128&this.control)||128&this.prevcontrol),i=!(!(64&this.control)||64&this.prevcontrol);if(t?(++this.song,this.song>this.numSongs&&(this.song=0),this.init()):i&&(--this.song,this.song<0&&(this.song=this.numSongs),this.init()),this.cpu&&this.unfinishedcounter>=this.time){const e=this.cpu.getPC()-1;this.cpu.idle=!1,this.cpu.push(e>>8),this.cpu.push(255&e),this.cpu.setPC(this.playAddr)}}}getROMInfo(){return`NSF INFO:
Size:     ${Math.floor(this.loader.romlen()/1024)} K
Expansion Sound:  ${this.expSound()}
Track: ${this.song+1} / ${this.numSongs+1}
Load Address:  ${h.hex(this.loadAddr)}
Init Address:  ${h.hex(this.initAddr)}
Play Address:  ${h.hex(this.playAddr)}
Banking?      ${this.nsfBanking?"Yes":"No"}
CRC:          ${h.hex(this.crc)}`}expSound(){const s=[];return this.vrc6&&s.push("VRC6"),this.vrc7&&s.push("VRC7"),this.n163&&s.push("Namco 163"),this.mmc5&&s.push("MMC5"),this.s5b&&s.push("Sunsoft 5B"),this.fds&&s.push("FDS"),s.length>0?s.join(" "):"None"}setBanks(){for(let s=0;s<this.prg_map.length;++s){const t=0|this.nsfBanks[Math.floor(s/4)];this.prg_map[s]=4096*t+s%4*1024,this.prg_map[s]>=this.prg.length&&(this.prg_map[s]%=this.prg.length)}}setSoundChip(){const s=this.cpuram?.apu;s&&((this.sndchip&h.BIT0)!==0&&(this.vrc6=!0,this.vrc6Audio=new p,s.addExpnSound(this.vrc6Audio)),(this.sndchip&h.BIT1)!==0&&(this.vrc7=!0,this.vrc7Audio=new f,s.addExpnSound(this.vrc7Audio)),(this.sndchip&h.BIT2)!==0&&(this.fds=!0,this.fdsAudio=new g,s.addExpnSound(this.fdsAudio)),(this.sndchip&h.BIT3)!==0&&(this.mmc5=!0,this.mmc5Audio=new A,s.addExpnSound(this.mmc5Audio)),(this.sndchip&h.BIT4)!==0&&(this.n163=!0,this.n163Audio=new u,s.addExpnSound(this.n163Audio)),(this.sndchip&h.BIT5)!==0&&(this.s5b=!0,this.s5bAudio=new v,s.addExpnSound(this.s5bAudio)))}writeTracks(){const s=`<Track ${`${this.song+1}`.padStart(3,"0")} / ${`${this.numSongs+1}`.padStart(3,"0")}>`;this.centerText(22,s)}getFps(){return this.region===a.PAL?50:60}formatTime(s){const t=this.getFps(),i=Math.floor(s/t),e=i%60,r=Math.floor(i/60)%60,n=o=>o.toString().padStart(2,"0");return`${n(Math.floor(i/3600))}:${n(r)}:${n(e)}`}updateTimeDisplay(){const s=this.formatTime(this.playFrames);this.centerText(24,s)}clearScreen(){for(let s=0;s<30;++s)for(let t=0;t<32;++t)this.pput0[32*s+t]=32}writeText(s,t,i){if(!this.pput0)return;const e=Math.max(0,Math.min(29,0|s));let r=Math.max(0,Math.min(31,0|t));for(let n=0;n<i.length&&r<32;++n,++r){const o=255&i.charCodeAt(n);this.pput0[32*e+r]=o}}centerText(s,t){const i=Math.max(0,Math.floor((32-t.length)/2));this.writeText(s,i,t)}drawSeparator(s,t="-"){const i=t.repeat(32).slice(0,32);this.writeText(s,0,i)}getHeaderString(s,t){const i=Math.min(this.loader.header.length,s+t);let e="";for(let r=s;r<i;++r){const n=this.loader.header[r];if(n===0)break;e+=String.fromCharCode(n)}return e.trim()}}export{d as default};

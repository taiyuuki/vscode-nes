import{s as e}from"./Sunsoft5BSoundChip-DT7x-Hu--Dc84w65d.js";import{r as t,t as i}from"./index-C1mDYnUx.js";import{n as a}from"./Mapper-DR43KiVi-C3VBMEhO.js";class p extends a{commandRegister=0;soundCommand=0;charbanks=new Array(8).fill(0);prgbanks=new Array(4).fill(0);ramEnable=!0;ramSelect=!1;irqcounter=65535;irqenabled=!1;irqclock=!1;hasInitSound=!1;sndchip=new e;interrupted=!1;loadROM(){super.loadROM(),this.prg_map=new Array(40).fill(0);for(let s=1;s<=40;++s)this.prg_map[40-s]=this.prgsize-1024*s;for(let s=0;s<8;++s)this.chr_map[s]=0}cartRead(s){return s>=24576?s<32768&&this.ramSelect?this.ramEnable?this.prgram[s-24576]:s>>8:this.prg[this.prg_map[s-24576>>10]+(1023&s)]:s>>8}cartWrite(s,r){if(s<32768||s>65535)super.cartWrite(s,r);else if(s===32768)this.commandRegister=15&r;else if(s===49152)this.soundCommand=15&r,this.hasInitSound||(this.cpuram?.apu?.addExpnSound(this.sndchip),this.hasInitSound=!0);else if(s===40960)switch(this.commandRegister){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:this.charbanks[this.commandRegister]=r,this.setbanks();break;case 8:this.ramEnable=(r&t.BIT7)!==0,this.ramSelect=(r&t.BIT6)!==0,this.prgbanks[0]=63&r,this.setbanks();break;case 9:case 10:case 11:this.prgbanks[this.commandRegister-8]=r,this.setbanks();break;case 12:switch(3&r){case 0:this.setmirroring(i.V_MIRROR);break;case 1:this.setmirroring(i.H_MIRROR);break;case 2:this.setmirroring(i.SS_MIRROR0);break;case 3:this.setmirroring(i.SS_MIRROR1)}break;case 13:this.irqclock=(r&t.BIT7)!==0,this.irqenabled=(r&t.BIT0)!==0,this.interrupted&&this.cpu.interrupt>0&&--this.cpu.interrupt,this.interrupted=!1;break;case 14:this.irqcounter&=65280,this.irqcounter|=r;break;case 15:this.irqcounter&=255,this.irqcounter|=r<<8}else s===57344&&this.sndchip.write(this.soundCommand,r)}cpucycle(){this.irqclock&&(this.irqcounter===0?(this.irqcounter=65535,this.irqenabled&&!this.interrupted&&(this.interrupted=!0,++this.cpu.interrupt)):--this.irqcounter)}setbanks(){for(let s=0;s<8;++s)for(let r=0;r<4;++r)this.prg_map[s+8*r]=1024*(s+8*this.prgbanks[r])%this.prgsize;for(let s=0;s<8;++s)this.chr_map[s]=1024*this.charbanks[s]%this.chrsize}}export{p as default};

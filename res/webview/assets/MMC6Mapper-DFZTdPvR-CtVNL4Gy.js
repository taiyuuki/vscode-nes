import{r as s}from"./index-C1mDYnUx.js";import n from"./MMC3Mapper-C80ixlo9-C15TrJWb.js";import"./Mapper-DR43KiVi-C3VBMEhO.js";class l extends n{prgRamEnable=!1;ramProtect=0;internalRam=new Uint8Array(1024);constructor(t){super(t),this.hasprgram=!1}cartWrite(t,r){if(t>=28672&&t<32768)this.writeInternalRam(t,r);else if(t<32768||t>65535)super.cartWrite(t,r);else switch(57345&t){case 32768:this.whichbank=7&r,this.prgRamEnable=(r&s.BIT5)!==0;const e=(r&s.BIT6)!==0;e!==this.prgconfig&&(this.prgconfig=e,this.setbank6());const a=(r&s.BIT7)!==0;a!==this.chrconfig&&(this.chrconfig=a,this.remapChrBanks());break;case 40961:this.prgRamEnable?this.ramProtect=r:this.ramProtect=0;break;default:super.cartWrite(t,r)}}cartRead(t){return t>=28672&&t<32768?this.readInternalRam(t):super.cartRead(t)}readInternalRam(t){const r=4095&t;return r<512?32&this.ramProtect?this.internalRam[r]:128&this.ramProtect?0:t>>8:r<1024?128&this.ramProtect?this.internalRam[r]:32&this.ramProtect?0:t>>8:this.readInternalRam(28672+(1023&t))}writeInternalRam(t,r){const e=4095&t;if(e<512){const a=!!(32&this.ramProtect),i=!!(16&this.ramProtect);a&&i&&(this.internalRam[e]=r)}else if(e<1024){const a=!!(128&this.ramProtect),i=!!(64&this.ramProtect);a&&i&&(this.internalRam[e]=r)}else this.writeInternalRam(28672+(1023&t),r)}postLoadState(t){super.postLoadState(t),t.internalRam&&this.internalRam.set(t.internalRam)}getMapperState(){const t=super.getMapperState();return t.prgRamEnable=this.prgRamEnable,t.ramProtect=this.ramProtect,t.internalRam=Array.from(this.internalRam),t}}export{l as default};
